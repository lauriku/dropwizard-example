{
  "variables": {
    "artifact": "{{ env `ARTIFACT_NAME` }}",
    "bucket": "{{ env `BUCKET` }}"
  },

  "builders": [
  {
    "type": "amazon-ebs",
    "region": "eu-west-1",
    "source_ami": "ami-c9e5e0af",
    "instance_type": "t2.micro",
    "ssh_username": "ubuntu",
    "ami_name": "dropwizard-example-{{timestamp}}",
    "iam_instance_profile": "jenkins"
  }],
  "provisioners": [
  {
    "type": "shell",
    "inline": [
      "sudo apt-get update -y"
    ]
  },
  {
    "type": "shell",
    "inline": [
      "sudo apt-get install -y openjdk-8-jre python python-pip",
      "sudo pip install awscli",
      "sudo mkdir -p /opt/dropwizard-example",
      "sudo chown -R ubuntu:ubuntu /opt/dropwizard-example",
      "aws s3 cp s3://{{ user `bucket` }}/{{ user `artifact` }} /opt/dropwizard-example"
    ]
  }
  ]
}
